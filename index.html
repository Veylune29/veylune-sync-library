<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VEYLUNE • Private Sync Library</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#050505; }
    .glass {
      background: rgba(10,10,10,.72);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(20,184,166,.18);
    }
    .logo-bg{
      position:fixed; inset:0;
      background: url("assets/logo.jpg") center/60% no-repeat;
      opacity:.10;
      pointer-events:none;
      z-index:0;
      filter: saturate(1.1) contrast(1.05);
    }
    .vignette{
      position:fixed; inset:0;
      background: radial-gradient(ellipse at center, rgba(0,0,0,.25) 0%, rgba(0,0,0,.85) 60%, rgba(0,0,0,.98) 100%);
      pointer-events:none;
      z-index:1;
    }
    .content { position: relative; z-index: 2; }
  </style>
</head>

<body class="text-white min-h-screen">
  <div class="logo-bg"></div>
  <div class="vignette"></div>

  <div class="content">
    <!-- Top Bar -->
    <header class="max-w-6xl mx-auto px-4 pt-8 pb-4">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <div class="text-2xl md:text-3xl font-bold tracking-tight">
            VEYLUNE <span class="text-teal-400">• Sync Library</span>
          </div>
          <div class="text-sm text-gray-300 mt-1">
            Listen to previews • Select tracks • Contact to license
          </div>
        </div>

        <div class="glass rounded-xl p-3 flex flex-col md:flex-row gap-2 md:items-center">
          <input id="search" type="text" placeholder="Search title, mood, key, BPM..."
            class="w-full md:w-80 bg-black/40 border border-teal-500/20 rounded-lg px-3 py-2 outline-none focus:border-teal-400"
          />
          <select id="moodFilter"
            class="bg-black/40 border border-teal-500/20 rounded-lg px-3 py-2 outline-none focus:border-teal-400"
          >
            <option value="">All moods</option>
          </select>
          <button id="clearBtn"
            class="px-4 py-2 rounded-lg bg-teal-600 hover:bg-teal-500 transition font-medium"
          >
            Clear
          </button>
        </div>
      </div>
    </header>

    <!-- Main -->
    <main class="max-w-6xl mx-auto px-4 pb-28">
      <!-- Now Playing -->
      <section class="glass rounded-2xl p-5 mb-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <div class="text-sm text-gray-300">Now Playing</div>
            <div id="nowTitle" class="text-xl font-semibold text-teal-300">Select a track</div>
            <div id="nowMeta" class="text-sm text-gray-300 mt-1">—</div>
          </div>

          <div class="w-full md:w-[480px]">
            <audio id="player" controls class="w-full"></audio>
            <div class="text-xs text-gray-400 mt-2">
              Previews only. Full stems/masters provided after licensing.
            </div>
          </div>
        </div>
      </section>

      <!-- Track List -->
      <section class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4" id="grid"></section>

      <!-- Empty -->
      <div id="empty" class="hidden mt-10 text-center text-gray-300">
        No tracks match your search.
      </div>
    </main>

    <!-- Footer -->
    <footer class="fixed bottom-0 inset-x-0 z-50">
      <div class="max-w-6xl mx-auto px-4 pb-4">
        <div class="glass rounded-2xl p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
          <div class="text-sm text-gray-300">
            Contact to license: <span class="text-teal-300 font-medium" id="emailText">youremail@example.com</span>
          </div>

          <div class="flex gap-2">
            <button id="contactBtn" class="px-4 py-2 rounded-lg bg-teal-600 hover:bg-teal-500 transition font-medium">
              Contact About Selected Track
            </button>
            <button id="copyBtn" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/15 transition font-medium border border-white/10">
              Copy Track ID
            </button>
          </div>
        </div>
      </div>
    </footer>
  </div>

<script>
/**
 * ✅ CONFIG: set your email once and you’re done.
 */
const CONTACT_EMAIL = "youremail@example.com";   // <-- CHANGE THIS
document.getElementById("emailText").textContent = CONTACT_EMAIL;

const $ = (id) => document.getElementById(id);
const grid = $("grid");
const empty = $("empty");
const player = $("player");
const nowTitle = $("nowTitle");
const nowMeta = $("nowMeta");
const search = $("search");
const moodFilter = $("moodFilter");
const clearBtn = $("clearBtn");
const contactBtn = $("contactBtn");
const copyBtn = $("copyBtn");

let TRACKS = [];
let selected = null;

function escapeHtml(str="") {
  return String(str).replace(/[&<>"']/g, s => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[s]));
}

function uniqMoods(tracks) {
  const set = new Set();
  tracks.forEach(t => (t.mood || []).forEach(m => set.add(m)));
  return Array.from(set).sort((a,b) => a.localeCompare(b));
}

function setMoodOptions(tracks) {
  const moods = uniqMoods(tracks);
  moodFilter.innerHTML = `<option value="">All moods</option>` + moods.map(m =>
    `<option value="${escapeHtml(m)}">${escapeHtml(m)}</option>`
  ).join("");
}

function matches(t, q, mood) {
  const text = ([
    t.id, t.title, (t.mood||[]).join(" "), t.key, String(t.bpm), t.notes
  ].join(" ")).toLowerCase();

  const okQ = !q || text.includes(q.toLowerCase());
  const okM = !mood || (t.mood || []).includes(mood);
  return okQ && okM;
}

function render() {
  const q = search.value.trim();
  const mood = moodFilter.value;

  const visible = TRACKS.filter(t => matches(t, q, mood));
  grid.innerHTML = visible.map(t => cardHtml(t)).join("");
  empty.classList.toggle("hidden", visible.length !== 0);

  // hook buttons
  visible.forEach(t => {
    const btn = document.querySelector(`[data-play="${CSS.escape(t.id)}"]`);
    if (btn) btn.addEventListener("click", () => selectTrack(t.id));
  });
}

function cardHtml(t) {
  const moods = (t.mood || []).map(m =>
    `<span class="text-xs px-2 py-1 rounded-full bg-teal-500/10 border border-teal-400/20 text-teal-200">${escapeHtml(m)}</span>`
  ).join(" ");

  return `
    <div class="glass rounded-2xl p-5">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="text-sm text-gray-300">${escapeHtml(t.id || "")}</div>
          <div class="text-lg font-semibold mt-1">${escapeHtml(t.title || "")}</div>
          <div class="text-sm text-gray-300 mt-1">
            ${escapeHtml(t.key || "—")} • ${escapeHtml(String(t.bpm ?? "—"))} BPM • Preview ${escapeHtml(t.length || "—")}
          </div>
        </div>
        <button
          data-play="${escapeHtml(t.id)}"
          class="shrink-0 px-3 py-2 rounded-lg bg-teal-600 hover:bg-teal-500 transition font-medium"
        >
          Play
        </button>
      </div>

      <div class="flex flex-wrap gap-2 mt-3">${moods || ""}</div>

      <div class="text-sm text-gray-300 mt-3">
        ${escapeHtml(t.notes || "")}
      </div>
    </div>
  `;
}

function selectTrack(id) {
  const t = TRACKS.find(x => x.id === id);
  if (!t) return;

  selected = t;

  nowTitle.textContent = t.title || "Selected Track";
  nowMeta.textContent = `${t.id || ""} • ${t.key || "—"} • ${t.bpm ?? "—"} BPM • Preview ${t.length || "—"}`;

  player.src = t.preview;
  player.play().catch(()=>{});
}

function mailtoForSelected() {
  if (!selected) return `mailto:${encodeURIComponent(CONTACT_EMAIL)}`;

  const subject = `Sync License Request — ${selected.id} — ${selected.title}`;
  const body =
`Hello,

I’m interested in licensing this track:

Track ID: ${selected.id}
Title: ${selected.title}
Mood: ${(selected.mood || []).join(", ")}
Key / BPM: ${selected.key || "—"} / ${selected.bpm ?? "—"}

Project details:
- Production/Brand:
- Usage (Film/TV/Ad/Game/YouTube/Podcast):
- Term (1yr, 2yr, perpetuity):
- Territory (US/Worldwide):
- Budget range:
- Deadline:

Please reply with licensing options and next steps.

Thank you.`;

  return `mailto:${encodeURIComponent(CONTACT_EMAIL)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}

contactBtn.addEventListener("click", () => {
  window.location.href = mailtoForSelected();
});

copyBtn.addEventListener("click", async () => {
  if (!selected?.id) return alert("Select a track first.");
  try {
    await navigator.clipboard.writeText(selected.id);
    copyBtn.textContent = "Copied!";
    setTimeout(()=> copyBtn.textContent = "Copy Track ID", 1000);
  } catch {
    alert("Copy failed. Track ID: " + selected.id);
  }
});

search.addEventListener("input", render);
moodFilter.addEventListener("change", render);
clearBtn.addEventListener("click", () => {
  search.value = "";
  moodFilter.value = "";
  render();
});

(async function init(){
  try {
    const res = await fetch("tracks.json", { cache: "no-store" });
    if (!res.ok) throw new Error("tracks.json not found");
    TRACKS = await res.json();

    setMoodOptions(TRACKS);
    render();
  } catch (e) {
    console.error(e);
    grid.innerHTML = `
      <div class="glass rounded-2xl p-6 col-span-full">
        <div class="text-lg font-semibold text-red-300">Setup error</div>
        <div class="text-sm text-gray-300 mt-2">
          Make sure <span class="text-teal-300 font-medium">tracks.json</span> exists in the same folder as index.html.
          Also confirm your audio files exist in the paths listed in tracks.json.
        </div>
      </div>
    `;
  }
})();
</script>
</body>
</html>
