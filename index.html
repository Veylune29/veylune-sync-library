<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VEYLUNE • Private Sync Library</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            teal: {
              50: '#f0fdfa', 100: '#ccfbf1', 200: '#99f6e4', 300: '#5eead4',
              400: '#2dd4bf', 500: '#14b8a6', 600: '#0d9488', 700: '#0f766e',
              800: '#115e59', 900: '#134e4a',
            }
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace']
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'float': 'float 6s ease-in-out infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-20px)' },
            }
          }
        }
      }
    }
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #111111;
      --bg-card: #151515;
      --border-color: #262626;
      --teal-primary: #0d9488;
      --teal-light: #2dd4bf;
      --text-primary: #ffffff;
      --text-secondary: #a3a3a3;
      --text-muted: #737373;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* optional background logo (put your logo at assets/logo.png) */
    .logo-bg {
      position: fixed;
      inset: 0;
      background: url("./assets/logo.png") center/60% no-repeat;
      opacity: .08;
      pointer-events: none;
      z-index: 0;
      filter: saturate(1.2);
    }
    .vignette {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 50% 30%, rgba(20,184,166,.10), transparent 50%),
                  radial-gradient(circle at 50% 90%, rgba(0,0,0,.65), rgba(0,0,0,.95));
      pointer-events: none;
      z-index: 0;
    }
    #app { position: relative; z-index: 1; }

    .glass {
      background: rgba(17, 17, 17, 0.85);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(38, 38, 38, 0.4);
    }
    .glass-light {
      background: rgba(30, 30, 30, 0.4);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(38, 38, 38, 0.2);
    }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: rgba(17, 17, 17, 0.3); }
    ::-webkit-scrollbar-thumb { background: rgba(13, 148, 136, 0.4); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(13, 148, 136, 0.6); }

    ::selection { background: rgba(13, 148, 136, 0.3); color: var(--teal-light); }

    .hover-lift { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .hover-lift:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3); }

    .gradient-text {
      background: linear-gradient(135deg, var(--teal-light) 0%, var(--teal-primary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .waveform-container { position: relative; height: 32px; overflow: hidden; }
    .waveform {
      position: absolute; inset: 0;
      background: linear-gradient(90deg,
        transparent 0%,
        rgba(13, 148, 136, 0.2) 20%,
        rgba(13, 148, 136, 0.4) 50%,
        rgba(13, 148, 136, 0.2) 80%,
        transparent 100%
      );
      opacity: 0.3;
      mask-image: url("data:image/svg+xml,%3Csvg width='200' height='32' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,16 Q10,4 20,16 T40,16 Q50,28 60,16 T80,16 Q90,4 100,16 T120,16 Q130,28 140,16 T160,16 Q170,4 180,16 T200,16' stroke='white' fill='none' stroke-width='2'/%3E%3C/svg%3E");
      mask-size: 200px 32px;
      mask-repeat: repeat-x;
      animation: waveform-scroll 20s linear infinite;
    }
    @keyframes waveform-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-200px); } }

    @keyframes pulse-teal {
      0%, 100% { box-shadow: 0 0 0 0 rgba(13, 148, 136, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(13, 148, 136, 0); }
    }
    .pulse-teal { animation: pulse-teal 2s infinite; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }

    input, select, textarea {
      background: rgba(17, 17, 17, 0.7);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      transition: all 0.2s;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--teal-primary);
      box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
    }

    input[type="range"] {
      -webkit-appearance: none;
      height: 4px;
      background: rgba(38, 38, 38, 0.5);
      border-radius: 2px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: var(--teal-primary);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s;
    }
    input[type="range"]::-webkit-slider-thumb:hover {
      background: var(--teal-light);
      transform: scale(1.2);
    }
  </style>
</head>

<body>
  <div class="logo-bg"></div>
  <div class="vignette"></div>

  <div id="app"></div>

  <!-- Audio Player -->
  <div id="player" class="fixed bottom-0 left-0 right-0 glass border-t border-gray-800 z-40 hidden">
    <div class="max-w-7xl mx-auto px-6 py-4">
      <div class="flex items-center justify-between gap-6">
        <!-- Track Info -->
        <div class="flex items-center gap-4 min-w-0 flex-1">
          <div class="relative">
            <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-teal-900 to-teal-800 flex items-center justify-center">
              <i class="fas fa-music text-teal-300"></i>
            </div>
            <div class="absolute -top-1 -right-1 w-3 h-3 bg-teal-500 rounded-full pulse-teal"></div>
          </div>
          <div class="min-w-0">
            <div id="playerTitle" class="font-medium truncate text-white">No track selected</div>
            <div id="playerArtist" class="text-sm truncate text-gray-400">Select a track to play</div>
          </div>
        </div>

        <!-- Controls -->
        <div class="flex items-center gap-4">
          <button id="prevBtn" class="p-2 text-gray-400 hover:text-white"><i class="fas fa-step-backward"></i></button>
          <button id="playBtn" class="p-3 bg-teal-600 hover:bg-teal-700 rounded-full transition-all">
            <i id="playIcon" class="fas fa-play text-white"></i>
          </button>
          <button id="nextBtn" class="p-2 text-gray-400 hover:text-white"><i class="fas fa-step-forward"></i></button>
        </div>

        <!-- Progress -->
        <div class="flex-1 max-w-2xl">
          <div class="flex items-center justify-between text-xs text-gray-500 mb-1">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
          </div>
          <div class="relative">
            <div class="waveform-container"><div class="waveform"></div></div>
            <input id="progressBar" type="range" min="0" max="100" value="0"
              class="w-full absolute top-0 opacity-0 hover:opacity-100 transition-opacity">
          </div>
        </div>

        <!-- Volume & Options -->
        <div class="flex items-center gap-3">
          <div class="flex items-center gap-2">
            <i class="fas fa-volume-up text-gray-400"></i>
            <input id="volumeBar" type="range" min="0" max="100" value="80" class="w-24">
          </div>
          <button id="closePlayer" class="p-2 text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
        </div>
      </div>
    </div>
  </div>

  <audio id="audioElement" preload="metadata"></audio>

  <script>
    class VeylunePlatform {
      constructor() {
        this.state = {
          authenticated: localStorage.getItem('veylune_auth') === 'true',
          tracks: [],
          currentTrack: null,
          isPlaying: false,
          volume: 80,
          filters: { search: '', mood: '', genre: '', bpm: '' },
          sortBy: 'newest'
        };

        this.elements = {
          app: document.getElementById('app'),
          player: document.getElementById('player'),
          audio: document.getElementById('audioElement'),
          playerTitle: document.getElementById('playerTitle'),
          playerArtist: document.getElementById('playerArtist'),
          playBtn: document.getElementById('playBtn'),
          playIcon: document.getElementById('playIcon'),
          progressBar: document.getElementById('progressBar'),
          volumeBar: document.getElementById('volumeBar'),
          currentTime: document.getElementById('currentTime'),
          duration: document.getElementById('duration'),
          closePlayer: document.getElementById('closePlayer'),
          prevBtn: document.getElementById('prevBtn'),
          nextBtn: document.getElementById('nextBtn')
        };

        this.init();
      }

      async init() {
        this.bindEvents();
        await this.loadTracksFromJson();
        this.render();
      }

      bindEvents() {
        this.elements.playBtn.addEventListener('click', () => this.togglePlayback());
        this.elements.closePlayer.addEventListener('click', () => this.hidePlayer());
        this.elements.prevBtn.addEventListener('click', () => this.playPrevious());
        this.elements.nextBtn.addEventListener('click', () => this.playNext());

        this.elements.progressBar.addEventListener('input', (e) => this.seek(e.target.value));
        this.elements.volumeBar.addEventListener('input', (e) => this.setVolume(e.target.value));

        this.elements.audio.addEventListener('timeupdate', () => this.updateProgress());
        this.elements.audio.addEventListener('loadedmetadata', () => this.updateProgress());
        this.elements.audio.addEventListener('ended', () => this.onTrackEnd());

        document.addEventListener('keydown', (e) => {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;

          switch (e.code) {
            case 'Space':
              e.preventDefault();
              this.togglePlayback();
              break;
            case 'Escape':
              this.hidePlayer();
              break;
            case 'ArrowLeft':
              if (e.altKey) this.playPrevious();
              break;
            case 'ArrowRight':
              if (e.altKey) this.playNext();
              break;
          }
        });
      }

      async loadTracksFromJson() {
        try {
          const res = await fetch('./data/tracks.json', { cache: 'no-store' });
          if (!res.ok) throw new Error('Could not load ./data/tracks.json');

          const tracks = await res.json();
          if (!Array.isArray(tracks)) throw new Error('tracks.json must be an array');

          this.state.tracks = tracks.map(t => ({
            id: t.id || (crypto?.randomUUID ? crypto.randomUUID() : String(Math.random()).slice(2)),
            title: t.title || 'Untitled',
            artist: t.artist || 'Veylune',
            album: t.album || '',
            bpm: Number(t.bpm || 0),
            key: t.key || '',
            duration: Number(t.duration || 0),
            mood: Array.isArray(t.mood) ? t.mood : [],
            genre: Array.isArray(t.genre) ? t.genre : [],
            instruments: Array.isArray(t.instruments) ? t.instruments : [],
            description: t.description || '',
            year: Number(t.year || new Date().getFullYear()),
            exclusive: !!t.exclusive,
            tags: Array.isArray(t.tags) ? t.tags : [],
            versions: Array.isArray(t.versions) ? t.versions : [],
            stems: !!t.stems,
            catalogNumber: t.catalogNumber || '',
            iswc: t.iswc || '',
            audio: t.audio || '' // MUST be like "./audio/yourfile.mp3"
          }));
        } catch (err) {
          console.error(err);
          this.state.tracks = [];
          this.showToast('ERROR: tracks.json not loading', 'error');
        }
      }

      render() {
        if (!this.state.authenticated) this.renderAuthScreen();
        else this.renderLibrary();
      }

      renderAuthScreen() {
        this.elements.app.innerHTML = `
          <div class="min-h-screen flex items-center justify-center p-4">
            <div class="w-full max-w-md space-y-8">
              <div class="text-center space-y-4">
                <div class="inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-teal-900 to-teal-800 border border-teal-800/50">
                  <i class="fas fa-wave-square text-3xl text-teal-300"></i>
                </div>
                <div>
                  <h1 class="text-4xl font-bold tracking-tight"><span class="gradient-text">VEYLUNE</span></h1>
                  <p class="text-gray-400 mt-2 font-light">Private Sync Music Library</p>
                </div>
              </div>

              <div class="glass rounded-2xl p-8 border border-gray-800/50 space-y-6 animate-fadeIn">
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2">
                    <i class="fas fa-key mr-2 text-teal-500"></i>Access Code
                  </label>
                  <div class="relative">
                    <input type="password" id="accessCode"
                      class="w-full pl-10 pr-4 py-3 bg-gray-900/50 border border-gray-800 rounded-lg focus:border-teal-600 focus:ring-1 focus:ring-teal-600 transition-all"
                      placeholder="Enter access code" autocomplete="off">
                    <i class="fas fa-lock absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
                  </div>
                  <p class="text-xs text-gray-500 mt-2">Contact administrator for access</p>
                </div>

                <div class="p-4 rounded-lg bg-gray-900/30 border border-gray-800">
                  <div class="flex items-start gap-3">
                    <i class="fas fa-info-circle text-teal-400 mt-0.5"></i>
                    <div class="text-sm text-gray-400">
                      <p class="font-medium text-gray-300 mb-1">Demo Access</p>
                      <p>Use code: <code class="px-2 py-1 bg-gray-800 rounded text-teal-300">sync2024</code></p>
                    </div>
                  </div>
                </div>

                <button onclick="platform.handleAuth()"
                  class="w-full py-3.5 rounded-lg bg-gradient-to-r from-teal-700 to-teal-600 hover:from-teal-600 hover:to-teal-500 text-white font-medium transition-all transform hover:-translate-y-0.5 active:scale-95">
                  <i class="fas fa-unlock-alt mr-2"></i>Access Library
                </button>

                <div class="relative">
                  <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-800"></div></div>
                  <div class="relative flex justify-center text-sm">
                    <span class="px-4 bg-gray-900 text-gray-500">For sync licensing inquiries</span>
                  </div>
                </div>

                <button onclick="platform.showContactModal()"
                  class="w-full py-3 rounded-lg border border-gray-800 hover:border-teal-700 hover:text-teal-300 text-gray-400 transition-colors">
                  <i class="fas fa-envelope mr-2"></i>Contact Administrator
                </button>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div class="glass-light rounded-xl p-4 text-center">
                  <i class="fas fa-music text-teal-400 text-lg mb-2"></i>
                  <div class="text-xs text-gray-400">Premium Catalog</div>
                </div>
                <div class="glass-light rounded-xl p-4 text-center">
                  <i class="fas fa-shield-alt text-teal-400 text-lg mb-2"></i>
                  <div class="text-xs text-gray-400">Secure Access</div>
                </div>
                <div class="glass-light rounded-xl p-4 text-center">
                  <i class="fas fa-file-contract text-teal-400 text-lg mb-2"></i>
                  <div class="text-xs text-gray-400">Professional Licensing</div>
                </div>
                <div class="glass-light rounded-xl p-4 text-center">
                  <i class="fas fa-headphones text-teal-400 text-lg mb-2"></i>
                  <div class="text-xs text-gray-400">HQ Audio</div>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      handleAuth() {
        const code = document.getElementById('accessCode')?.value || '';
        if (code === 'sync2024') {
          this.state.authenticated = true;
          localStorage.setItem('veylune_auth', 'true');
          this.showToast('Access granted', 'success');
          this.renderLibrary();
        } else {
          this.showToast('Invalid access code', 'error');
        }
      }

      renderLibrary() {
        this.elements.app.innerHTML = `
          <header class="sticky top-0 z-30 glass border-b border-gray-800/50">
            <div class="max-w-7xl mx-auto px-6 py-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="p-2 rounded-lg bg-gradient-to-br from-teal-900 to-teal-800 border border-teal-800/50">
                    <i class="fas fa-wave-square text-teal-300"></i>
                  </div>
                  <div>
                    <div class="font-bold text-lg tracking-tight"><span class="gradient-text">VEYLUNE</span></div>
                    <div class="text-xs text-gray-500">Private Sync Library</div>
                  </div>
                </div>

                <div class="flex items-center gap-3">
                  <button onclick="platform.showContactModal()"
                    class="px-4 py-2 rounded-lg border border-gray-800 hover:border-teal-700 hover:text-teal-300 text-gray-400 text-sm transition-colors">
                    <i class="fas fa-handshake mr-2"></i>Contact
                  </button>
                  <button onclick="platform.logout()"
                    class="px-4 py-2 rounded-lg bg-gray-900 hover:bg-gray-800 text-gray-300 text-sm transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                  </button>
                </div>
              </div>
            </div>
          </header>

          <main class="max-w-7xl mx-auto px-6 py-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
              <div class="glass rounded-xl p-5 border border-gray-800/50">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-2xl font-bold">${this.state.tracks.length}</div>
                    <div class="text-sm text-gray-500">Total Tracks</div>
                  </div>
                  <i class="fas fa-music text-teal-500"></i>
                </div>
              </div>
              <div class="glass rounded-xl p-5 border border-gray-800/50">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-2xl font-bold">${this.state.tracks.filter(t => t.exclusive).length}</div>
                    <div class="text-sm text-gray-500">Exclusive</div>
                  </div>
                  <i class="fas fa-crown text-amber-500"></i>
                </div>
              </div>
              <div class="glass rounded-xl p-5 border border-gray-800/50">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-2xl font-bold">24/7</div>
                    <div class="text-sm text-gray-500">Access</div>
                  </div>
                  <i class="fas fa-clock text-emerald-500"></i>
                </div>
              </div>
              <div class="glass rounded-xl p-5 border border-gray-800/50">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="text-2xl font-bold"><i class="fas fa-bolt text-teal-500"></i></div>
                    <div class="text-sm text-gray-500">Available Now</div>
                  </div>
                  <i class="fas fa-check-circle text-teal-500"></i>
                </div>
              </div>
            </div>

            <div class="glass rounded-xl p-6 mb-8 border border-gray-800/50">
              <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <div class="relative">
                  <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
                  <input type="text"
                    class="w-full pl-10 pr-3 py-2.5 bg-gray-900/50 border border-gray-800 rounded-lg text-sm focus:border-teal-600"
                    placeholder="Search tracks..."
                    oninput="platform.handleSearch(event)">
                </div>

                <select class="bg-gray-900/50 border border-gray-800 rounded-lg px-3 py-2.5 text-sm focus:border-teal-600"
                  onchange="platform.handleFilter('mood', event)">
                  <option value="">All Moods</option>
                  <option value="cinematic">Cinematic</option>
                  <option value="emotional">Emotional</option>
                  <option value="epic">Epic</option>
                  <option value="ambient">Ambient</option>
                  <option value="energetic">Energetic</option>
                </select>

                <select class="bg-gray-900/50 border border-gray-800 rounded-lg px-3 py-2.5 text-sm focus:border-teal-600"
                  onchange="platform.handleFilter('genre', event)">
                  <option value="">All Genres</option>
                  <option value="synthwave">Synthwave</option>
                  <option value="orchestral">Orchestral</option>
                  <option value="electronic">Electronic</option>
                  <option value="ambient">Ambient</option>
                  <option value="world">World</option>
                </select>

                <select class="bg-gray-900/50 border border-gray-800 rounded-lg px-3 py-2.5 text-sm focus:border-teal-600"
                  onchange="platform.handleFilter('bpm', event)">
                  <option value="">All BPM</option>
                  <option value="slow">Slow (60-90)</option>
                  <option value="medium">Medium (91-120)</option>
                  <option value="fast">Fast (121-160)</option>
                </select>

                <select class="bg-gray-900/50 border border-gray-800 rounded-lg px-3 py-2.5 text-sm focus:border-teal-600"
                  onchange="platform.handleSort(event)">
                  <option value="newest">Newest First</option>
                  <option value="oldest">Oldest First</option>
                  <option value="title">Title A-Z</option>
                  <option value="bpm">BPM ↑</option>
                  <option value="duration">Duration ↑</option>
                </select>
              </div>
            </div>

            <div id="tracksGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              ${this.renderTracksGrid()}
            </div>
          </main>
        `;
      }

      renderTracksGrid() {
        let filtered = [...this.state.tracks];

        const s = (this.state.filters.search || '').trim().toLowerCase();
        if (s) {
          filtered = filtered.filter(t =>
            (t.title || '').toLowerCase().includes(s) ||
            (t.artist || '').toLowerCase().includes(s) ||
            (t.description || '').toLowerCase().includes(s) ||
            (t.tags || []).some(tag => String(tag).toLowerCase().includes(s))
          );
        }

        if (this.state.filters.mood) {
          filtered = filtered.filter(t => (t.mood || []).includes(this.state.filters.mood));
        }

        if (this.state.filters.genre) {
          filtered = filtered.filter(t => (t.genre || []).includes(this.state.filters.genre));
        }

        if (this.state.filters.bpm) {
          filtered = filtered.filter(t => {
            const bpm = Number(t.bpm || 0);
            if (this.state.filters.bpm === 'slow') return bpm >= 60 && bpm <= 90;
            if (this.state.filters.bpm === 'medium') return bpm >= 91 && bpm <= 120;
            if (this.state.filters.bpm === 'fast') return bpm >= 121 && bpm <= 160;
            return true;
          });
        }

        filtered.sort((a, b) => {
          switch (this.state.sortBy) {
            case 'newest': return Number(b.year || 0) - Number(a.year || 0);
            case 'oldest': return Number(a.year || 0) - Number(b.year || 0);
            case 'title': return String(a.title || '').localeCompare(String(b.title || ''));
            case 'bpm': return Number(a.bpm || 0) - Number(b.bpm || 0);
            case 'duration': return Number(a.duration || 0) - Number(b.duration || 0);
            default: return 0;
          }
        });

        if (filtered.length === 0) {
          return `
            <div class="col-span-3 text-center py-16">
              <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-900/50 mb-4">
                <i class="fas fa-search text-gray-600 text-2xl"></i>
              </div>
              <h3 class="text-lg font-medium text-gray-300 mb-2">No tracks found</h3>
              <p class="text-gray-500">Try adjusting your search or filters</p>
            </div>
          `;
        }

        return filtered.map(track => `
          <div class="glass rounded-xl border border-gray-800/50 overflow-hidden hover-lift animate-fadeIn">
            <div class="p-5 border-b border-gray-800/50">
              <div class="flex items-start justify-between mb-3">
                <div>
                  <div class="flex items-center gap-2 mb-2">
                    ${track.exclusive ? `
                      <span class="px-2 py-1 rounded-full text-xs bg-amber-900/30 text-amber-300 border border-amber-800/30">
                        <i class="fas fa-crown mr-1"></i>Exclusive
                      </span>
                    ` : ''}
                    ${(track.mood && track.mood[0]) ? `
                      <span class="px-2 py-1 rounded-full text-xs bg-teal-900/30 text-teal-300 border border-teal-800/30">
                        ${this.escapeHtml(track.mood[0])}
                      </span>
                    ` : ''}
                  </div>
                  <h3 class="font-bold text-lg mb-1">${this.escapeHtml(track.title || 'Untitled')}</h3>
                  <div class="text-sm text-gray-400">
                    ${this.escapeHtml(track.artist || 'Veylune')} • ${Number(track.bpm || 0)} BPM • ${this.formatTime(Number(track.duration || 0))}
                  </div>
                </div>

                <button onclick="platform.playTrack('${this.escapeAttr(track.id)}')"
                  class="p-3 rounded-full bg-gradient-to-br from-teal-800 to-teal-700 hover:from-teal-700 hover:to-teal-600 transition-all">
                  <i class="fas fa-play text-white"></i>
                </button>
              </div>

              <p class="text-sm text-gray-300 line-clamp-2">${this.escapeHtml(track.description || '')}</p>
            </div>

            <div class="p-5">
              <div class="flex flex-wrap gap-2 mb-4">
                ${(track.tags || []).slice(0, 3).map(tag => `
                  <span class="px-2 py-1 rounded text-xs bg-gray-900/50 text-gray-400 border border-gray-800">
                    ${this.escapeHtml(tag)}
                  </span>
                `).join('')}
                ${track.stems ? `
                  <span class="px-2 py-1 rounded text-xs bg-purple-900/30 text-purple-300 border border-purple-800/30">
                    <i class="fas fa-layer-group mr-1"></i>Stems
                  </span>
                ` : ''}
              </div>

              <div class="grid grid-cols-2 gap-3 text-sm">
                <div class="flex items-center gap-2">
                  <i class="fas fa-music text-gray-500"></i>
                  <span class="text-gray-400">Key:</span>
                  <span class="text-gray-300">${this.escapeHtml(track.key || '-')}</span>
                </div>
                <div class="flex items-center gap-2">
                  <i class="fas fa-clock text-gray-500"></i>
                  <span class="text-gray-400">Audio:</span>
                  <span class="text-gray-300">${track.audio ? 'Yes' : 'No'}</span>
                </div>
                <div class="flex items-center gap-2">
                  <i class="fas fa-drum text-gray-500"></i>
                  <span class="text-gray-400">Genre:</span>
                  <span class="text-gray-300">${this.escapeHtml((track.genre && track.genre[0]) ? track.genre[0] : '-')}</span>
                </div>
                <div class="flex items-center gap-2">
                  <i class="fas fa-calendar text-gray-500"></i>
                  <span class="text-gray-400">Year:</span>
                  <span class="text-gray-300">${Number(track.year || 0) || '-'}</span>
                </div>
              </div>
            </div>

            <div class="p-4 border-t border-gray-800/50 bg-gray-900/20">
              <div class="flex items-center justify-between">
                <div class="text-xs text-gray-500">
                  Catalog: ${this.escapeHtml(track.catalogNumber || '-')}
                </div>
                <div class="flex gap-2">
                  <button onclick="platform.showTrackInfo('${this.escapeAttr(track.id)}')"
                    class="px-3 py-1.5 rounded-lg border border-gray-800 hover:border-teal-700 hover:text-teal-300 text-gray-400 text-sm transition-colors">
                    <i class="fas fa-info-circle mr-1"></i>Info
                  </button>
                  <button onclick="platform.showContactModal()"
                    class="px-3 py-1.5 rounded-lg bg-gradient-to-r from-teal-700 to-teal-600 hover:from-teal-600 hover:to-teal-500 text-white text-sm transition-colors">
                    <i class="fas fa-file-contract mr-1"></i>License
                  </button>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      }

      // REAL AUDIO PLAYBACK
      playTrack(trackId) {
        const track = this.state.tracks.find(t => String(t.id) === String(trackId));
        if (!track) return;

        if (!track.audio) {
          this.showToast('No audio path set for this track in tracks.json', 'error');
          return;
        }

        this.state.currentTrack = track;

        this.elements.playerTitle.textContent = track.title || 'Untitled';
        this.elements.playerArtist.textContent = track.artist || 'Veylune';
        this.elements.player.classList.remove('hidden');

        // load audio
        this.elements.audio.src = track.audio;
        this.elements.audio.currentTime = 0;
        this.elements.audio.volume = this.state.volume / 100;

        // play
        this.elements.audio.play().then(() => {
          this.state.isPlaying = true;
          this.elements.playIcon.className = 'fas fa-pause';
          this.showToast(`Playing: ${track.title}`, 'success');
        }).catch((e) => {
          console.error(e);
          this.state.isPlaying = false;
          this.elements.playIcon.className = 'fas fa-play';
          this.showToast('Browser blocked autoplay—click Play again', 'error');
        });
      }

      togglePlayback() {
        if (!this.state.currentTrack) {
          this.showToast('Select a track first', 'info');
          return;
        }

        if (this.elements.audio.paused) {
          this.elements.audio.play().then(() => {
            this.state.isPlaying = true;
            this.elements.playIcon.className = 'fas fa-pause';
          }).catch((e) => {
            console.error(e);
            this.showToast('Playback blocked—press play on a track first', 'error');
          });
        } else {
          this.elements.audio.pause();
          this.state.isPlaying = false;
          this.elements.playIcon.className = 'fas fa-play';
        }
      }

      playPrevious() {
        if (!this.state.currentTrack) return;
        const idx = this.state.tracks.findIndex(t => t.id === this.state.currentTrack.id);
        if (idx > 0) this.playTrack(this.state.tracks[idx - 1].id);
      }

      playNext() {
        if (!this.state.currentTrack) return;
        const idx = this.state.tracks.findIndex(t => t.id === this.state.currentTrack.id);
        if (idx < this.state.tracks.length - 1) this.playTrack(this.state.tracks[idx + 1].id);
      }

      seek(percent) {
        const a = this.elements.audio;
        if (!isFinite(a.duration) || a.duration <= 0) return;
        a.currentTime = (Number(percent) / 100) * a.duration;
      }

      setVolume(percent) {
        this.state.volume = Number(percent);
        this.elements.audio.volume = this.state.volume / 100;
      }

      updateProgress() {
        const a = this.elements.audio;
        if (!this.state.currentTrack || !isFinite(a.duration) || a.duration <= 0) return;

        const pct = (a.currentTime / a.duration) * 100;
        this.elements.progressBar.value = pct;
        this.elements.currentTime.textContent = this.formatTime(a.currentTime);
        this.elements.duration.textContent = this.formatTime(a.duration);
      }

      onTrackEnd() {
        this.state.isPlaying = false;
        this.elements.playIcon.className = 'fas fa-play';
        this.elements.progressBar.value = 0;
        this.elements.currentTime.textContent = '0:00';
      }

      hidePlayer() {
        this.elements.player.classList.add('hidden');
        this.elements.audio.pause();
        this.state.isPlaying = false;
        this.elements.playIcon.className = 'fas fa-play';
      }

      handleSearch(event) {
        this.state.filters.search = event.target.value;
        const grid = document.getElementById('tracksGrid');
        if (grid) grid.innerHTML = this.renderTracksGrid();
      }

      handleFilter(type, event) {
        this.state.filters[type] = event.target.value;
        const grid = document.getElementById('tracksGrid');
        if (grid) grid.innerHTML = this.renderTracksGrid();
      }

      handleSort(event) {
        this.state.sortBy = event.target.value;
        const grid = document.getElementById('tracksGrid');
        if (grid) grid.innerHTML = this.renderTracksGrid();
      }

      showContactModal() {
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4';
        modal.innerHTML = `
          <div class="glass rounded-2xl w-full max-w-lg border border-gray-800/50 overflow-hidden">
            <div class="p-6 border-b border-gray-800/50">
              <div class="flex items-center justify-between">
                <div>
                  <h2 class="text-xl font-bold">Contact for Licensing</h2>
                  <p class="text-sm text-gray-400">Discuss sync fees, royalties, and terms</p>
                </div>
                <button class="p-2 text-gray-400 hover:text-white" id="closeModalBtn">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>

            <form class="p-6 space-y-4" id="contactForm">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" placeholder="Your Name" required class="px-4 py-3 bg-gray-900/50 border border-gray-800 rounded-lg focus:border-teal-600">
                <input type="email" placeholder="Email" required class="px-4 py-3 bg-gray-900/50 border border-gray-800 rounded-lg focus:border-teal-600">
              </div>
              <input type="text" placeholder="Company / Production" class="w-full px-4 py-3 bg-gray-900/50 border border-gray-800 rounded-lg focus:border-teal-600">
              <select class="w-full px-4 py-3 bg-gray-900/50 border border-gray-800 rounded-lg focus:border-teal-600">
                <option value="">Project Type</option>
                <option value="film">Film</option>
                <option value="tv">TV Show</option>
                <option value="commercial">Commercial</option>
                <option value="trailer">Trailer</option>
                <option value="video_game">Video Game</option>
              </select>
              <textarea rows="3" placeholder="Project details, budget, timeline..." class="w-full px-4 py-3 bg-gray-900/50 border border-gray-800 rounded-lg focus:border-teal-600"></textarea>

              <button type="submit"
                class="w-full py-3.5 rounded-lg bg-gradient-to-r from-teal-700 to-teal-600 hover:from-teal-600 hover:to-teal-500 text-white font-medium transition-all">
                <i class="fas fa-paper-plane mr-2"></i>Send Inquiry
              </button>
            </form>

            <div class="p-6 border-t border-gray-800/50 bg-gray-900/30">
              <div class="space-y-3">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-lg bg-teal-900/30 flex items-center justify-center">
                    <i class="fas fa-envelope text-teal-400"></i>
                  </div>
                  <div>
                    <div class="text-sm text-gray-400">Licensing Email</div>
                    <div class="text-white">sync@veylune.com</div>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-lg bg-teal-900/30 flex items-center justify-center">
                    <i class="fas fa-phone text-teal-400"></i>
                  </div>
                  <div>
                    <div class="text-sm text-gray-400">Phone/Zoom</div>
                    <div class="text-white">+1 (424) 123-4567</div>
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-lg bg-teal-900/30 flex items-center justify-center">
                    <i class="fas fa-clock text-teal-400"></i>
                  </div>
                  <div>
                    <div class="text-sm text-gray-400">Response Time</div>
                    <div class="text-white">2-4 business hours</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;

        document.body.appendChild(modal);

        modal.querySelector('#closeModalBtn').addEventListener('click', () => modal.remove());
        modal.querySelector('#contactForm').addEventListener('submit', (e) => {
          e.preventDefault();
          this.showToast("Inquiry sent! We'll contact you shortly.", "success");
          modal.remove();
        });
      }

      showTrackInfo(trackId) {
        const track = this.state.tracks.find(t => String(t.id) === String(trackId));
        if (!track) return;

        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4';
        modal.innerHTML = `
          <div class="glass rounded-2xl w-full max-w-2xl border border-gray-800/50 overflow-hidden max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-800/50">
              <div class="flex items-start justify-between">
                <div>
                  <h2 class="text-2xl font-bold mb-2">${this.escapeHtml(track.title || 'Untitled')}</h2>
                  <div class="flex items-center gap-4 text-sm text-gray-400">
                    <span><i class="fas fa-user mr-1"></i>${this.escapeHtml(track.artist || 'Veylune')}</span>
                    <span><i class="fas fa-tachometer-alt mr-1"></i>${Number(track.bpm || 0)} BPM</span>
                    <span><i class="fas fa-clock mr-1"></i>${this.formatTime(Number(track.duration || 0))}</span>
                  </div>
                </div>
                <button class="p-2 text-gray-400 hover:text-white" id="closeInfoBtn"><i class="fas fa-times"></i></button>
              </div>
            </div>

            <div class="p-6 space-y-6">
              <div>
                <h3 class="font-semibold text-teal-300 mb-2 flex items-center gap-2">
                  <i class="fas fa-align-left"></i>Description
                </h3>
                <p class="text-gray-300">${this.escapeHtml(track.description || '')}</p>
              </div>

              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="space-y-1"><div class="text-xs text-gray-500">Key</div><div class="font-medium">${this.escapeHtml(track.key || '-')}</div></div>
                <div class="space-y-1"><div class="text-xs text-gray-500">Year</div><div class="font-medium">${Number(track.year || 0) || '-'}</div></div>
                <div class="space-y-1"><div class="text-xs text-gray-500">Catalog No</div><div class="font-medium">${this.escapeHtml(track.catalogNumber || '-')}</div></div>
                <div class="space-y-1"><div class="text-xs text-gray-500">ISWC</div><div class="font-medium text-sm">${this.escapeHtml(track.iswc || '-')}</div></div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <h3 class="font-semibold text-teal-300 mb-2 flex items-center gap-2"><i class="fas fa-heart"></i>Moods</h3>
                  <div class="flex flex-wrap gap-2">
                    ${(track.mood || []).map(m => `
                      <span class="px-3 py-1 rounded-full text-sm bg-gray-900/50 text-gray-300 border border-gray-800">${this.escapeHtml(m)}</span>
                    `).join('') || `<span class="text-gray-500 text-sm">—</span>`}
                  </div>
                </div>
                <div>
                  <h3 class="font-semibold text-teal-300 mb-2 flex items-center gap-2"><i class="fas fa-music"></i>Genres</h3>
                  <div class="flex flex-wrap gap-2">
                    ${(track.genre || []).map(g => `
                      <span class="px-3 py-1 rounded-full text-sm bg-gray-900/50 text-gray-300 border border-gray-800">${this.escapeHtml(g)}</span>
                    `).join('') || `<span class="text-gray-500 text-sm">—</span>`}
                  </div>
                </div>
              </div>

              <div>
                <h3 class="font-semibold text-teal-300 mb-2 flex items-center gap-2"><i class="fas fa-guitar"></i>Instruments</h3>
                <div class="flex flex-wrap gap-2">
                  ${(track.instruments || []).map(i => `
                    <span class="px-3 py-1 rounded-lg text-sm bg-gray-900/50 text-gray-300 border border-gray-800">
                      <i class="fas fa-circle text-teal-500 text-xs mr-1"></i>${this.escapeHtml(i)}
                    </span>
                  `).join('') || `<span class="text-gray-500 text-sm">—</span>`}
                </div>
              </div>

              <div class="pt-6 border-t border-gray-800/50 flex gap-3">
                <button onclick="platform.playTrack('${this.escapeAttr(track.id)}')"
                  class="flex-1 py-3 rounded-lg bg-gradient-to-r from-teal-700 to-teal-600 hover:from-teal-600 hover:to-teal-500 text-white font-medium transition-all">
                  <i class="fas fa-play mr-2"></i>Play Track
                </button>
                <button onclick="platform.showContactModal()"
                  class="flex-1 py-3 rounded-lg border border-teal-800 text-teal-300 hover:bg-teal-900/20 transition-colors">
                  <i class="fas fa-file-contract mr-2"></i>License Track
                </button>
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        modal.querySelector('#closeInfoBtn').addEventListener('click', () => modal.remove());
      }

      formatTime(seconds) {
        const s = Number(seconds || 0);
        const mins = Math.floor(s / 60);
        const secs = Math.floor(s % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      }

      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = String(text ?? '');
        return div.innerHTML;
      }

      escapeAttr(text) {
        return String(text ?? '').replace(/'/g, '&#39;');
      }

      showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `fixed top-4 right-4 glass rounded-lg p-4 border ${
          type === 'error' ? 'border-red-800' : type === 'success' ? 'border-teal-800' : 'border-gray-800'
        } z-50 animate-fadeIn`;

        toast.innerHTML = `
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full ${
              type === 'error' ? 'bg-red-900/30' : type === 'success' ? 'bg-teal-900/30' : 'bg-gray-900/30'
            } flex items-center justify-center">
              <i class="fas ${
                type === 'error' ? 'fa-exclamation-triangle text-red-400' :
                type === 'success' ? 'fa-check-circle text-teal-400' :
                'fa-info-circle text-gray-400'
              }"></i>
            </div>
            <div class="font-medium">${this.escapeHtml(message)}</div>
          </div>
        `;

        document.body.appendChild(toast);
        setTimeout(() => {
          toast.style.animation = 'fadeIn 0.5s ease-out reverse forwards';
          setTimeout(() => toast.remove(), 500);
        }, 3000);
      }

      logout() {
        this.state.authenticated = false;
        localStorage.removeItem('veylune_auth');
        this.hidePlayer();
        this.showToast('Logged out successfully', 'info');
        setTimeout(() => this.render(), 150);
      }
    }

    const platform = new VeylunePlatform();
    window.platform = platform;
  </script>
</body>
</html>
